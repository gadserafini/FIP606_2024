{
  "hash": "61d49b559da41e4c91f576ff2d15fda2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Análise Estatística: Estatística inferencial - Parte 2\"\nauthor: \"Gabriel A D Serafini\"\nformat: html\neditor: visual\n---\n\n\n# Análise de Variância (ANOVA)\n\n## One-Way ANOVA\n\nA **One-Way ANOVA** (Análise de Variância de um Fator) é um teste estatístico utilizado para determinar se existem diferenças significativas entre as médias de três ou mais grupos independentes. A \"one-way\" refere-se ao fato de que há apenas uma variável independente (fator) sendo testada. Este teste é usado quando se quer comparar as médias de diferentes grupos para verificar se pelo menos um grupo difere significativamente dos outros.\n\nDesta vez iniciaremos garantindo que todos os gráficos tenham uma aparência unica ao longo do documento, para isso, configuraremos o tema para `theme_bw()` usando a função `theme_set()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\ntheme_set(theme_bw())\n```\n:::\n\n\nPara este tópico utilizamos o conjunto de dados `InsectSprays` para nossa análise. Este conjunto de dados contém informações sobre a contagem de insetos após a aplicação de diferentes sprays.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninseticida <- InsectSprays\nhead(inseticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  count spray\n1    10     A\n2     7     A\n3    20     A\n4    14     A\n5    14     A\n6    12     A\n```\n\n\n:::\n:::\n\n\nAntes de prosseguir com a análise, é útil entender a distribuição das observações entre os diferentes tipos de spray. Para isso, utilizamos a função `count()` do pacote `tidyverse`, que conta o número de ocorrências de cada categoria na variável `spray`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ninseticida |> \n  count(spray)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  spray  n\n1     A 12\n2     B 12\n3     C 12\n4     D 12\n5     E 12\n6     F 12\n```\n\n\n:::\n:::\n\n\nA função `count()` é usada para contar as ocorrências de valores únicos em uma coluna. No caso acima, estamos contando quantas vezes cada tipo de spray aparece no conjunto de dados `InsectSprays`.\n\nPara ter uma visão geral da contagem por tipo de spray, usamos o *boxplot* (gráfico de caixa) e *jitter* para a dispersão.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ninseticida |>\n  ggplot(aes(x = spray, y = count))+\n  geom_boxplot()+\n  geom_jitter()+\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nO boxplot dá indícios de que as médias C, D e E diferem das demais. Entretanto, o plot da variatiância dos dados é bem grande e com presença de outliers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(count ~ spray,\n         data = inseticida)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = count ~ spray, data = inseticida)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-8.333 -1.958 -0.500  1.667  9.333 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  14.5000     1.1322  12.807  < 2e-16 ***\nsprayB        0.8333     1.6011   0.520    0.604    \nsprayC      -12.4167     1.6011  -7.755 7.27e-11 ***\nsprayD       -9.5833     1.6011  -5.985 9.82e-08 ***\nsprayE      -11.0000     1.6011  -6.870 2.75e-09 ***\nsprayF        2.1667     1.6011   1.353    0.181    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.922 on 66 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.7036 \nF-statistic:  34.7 on 5 and 66 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 2668.8  533.77  34.702 < 2.2e-16 ***\nResiduals 66 1015.2   15.38                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nSegundo a one-way ANOVA, o p-valor associado ao teste F foi \\< 0.05, indicando que há uma diferença estatisticamente significativa entre pelo menos um par de grupos de spray.\n\n### Diagnóstico dos Resíduos\n\nPara garantir que o modelo ANOVA seja válido, verificamos os resíduos do modelo para normalidade e homocedasticidade. Inicialmente a normalidade dos resíduos e a homocedasticidade foram verificadas usando um histograma e um gráfico QQ, respectivamente.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1$residuals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          1           2           3           4           5           6 \n-4.50000000 -7.50000000  5.50000000 -0.50000000 -0.50000000 -2.50000000 \n          7           8           9          10          11          12 \n-4.50000000  8.50000000  2.50000000  5.50000000 -0.50000000 -1.50000000 \n         13          14          15          16          17          18 \n-4.33333333  1.66666667  5.66666667 -4.33333333  0.66666667 -1.33333333 \n         19          20          21          22          23          24 \n 1.66666667  1.66666667  3.66666667  5.66666667 -8.33333333 -2.33333333 \n         25          26          27          28          29          30 \n-2.08333333 -1.08333333  4.91666667 -0.08333333  0.91666667 -1.08333333 \n         31          32          33          34          35          36 \n-0.08333333 -1.08333333  0.91666667 -2.08333333 -1.08333333  1.91666667 \n         37          38          39          40          41          42 \n-1.91666667  0.08333333  7.08333333  1.08333333 -0.91666667 -1.91666667 \n         43          44          45          46          47          48 \n 0.08333333  0.08333333  0.08333333  0.08333333 -2.91666667 -0.91666667 \n         49          50          51          52          53          54 \n-0.50000000  1.50000000 -0.50000000  1.50000000 -0.50000000  2.50000000 \n         55          56          57          58          59          60 \n-2.50000000 -2.50000000 -0.50000000 -1.50000000  2.50000000  0.50000000 \n         61          62          63          64          65          66 \n-5.66666667 -7.66666667 -1.66666667  5.33333333 -1.66666667 -0.66666667 \n         67          68          69          70          71          72 \n-3.66666667 -6.66666667  9.33333333  9.33333333  7.33333333 -3.66666667 \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(m1$residuals)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(m1$residuals)\nqqline(m1$residuals)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\nSegundo obvervado no histograma, os residuos aparentemente seguem uma distribuição normal. Olhando o gráfico QQ os pontos extremos se distanciam em muito a linha central, o que indica não haver homocedesticidade.\n\nEntretanto, para sabermos definitivamente, de uma forma não subjetiva, se os dados atendem aos preceitos estátisticos, foram feitos o teste de Shapiro-Wilk, para verificar a normalidade e Bartlett para testarmos a homogeneidade de variância.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(m1$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  m1$residuals\nW = 0.96006, p-value = 0.02226\n```\n\n\n:::\n\n```{.r .cell-code}\nbartlett.test(count ~ spray,\n              data = inseticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count by spray\nBartlett's K-squared = 25.96, df = 5, p-value = 9.085e-05\n```\n\n\n:::\n:::\n\n\nEm ambos os testes o p-valor foi \\< 0.05, assim os dados não apresentam normalidade e homogeneidade de variância pelo teste de Shapiro-Wilk e Bartllet, respectivamente. Destre deste preceitos estatísticos, a falta de normalidade é mais \"leve\" do que a falta de homocedasticidade.\n\nOutras funções como `check_normality()` e `check_heteroscedasticity()` do pacote `performance` são outras opções poderosas de ferramentas para verificar os pressupostos de normalidade e homocedasticidade.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(performance)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: pacote 'performance' foi compilado no R versão 4.4.1\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_normality(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Non-normality of residuals detected (p = 0.022).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Heteroscedasticity (non-constant error variance) detected (p < .001).\n```\n\n\n:::\n:::\n\n\nAs funções do pacote `performance` oferecem uma saída escrita e em cores que identificam se atendeu (verde) ou não (vermelho) ao teste em que os dados foram submetidos. Essas verificações são essenciais para garantir que as inferências estatísticas sejam válidas.\n\nNo caso do exemplo, como dito anteriormente, os dados não apresentaram normalidade e homogeneidade de variância.\n\nOutra opção é a utilização do pacote `DHARMa` (Residual Diagnostics for Hierarchical (Multi-Level / Mixed) Regression Models), ecificamente a função `simulateResiduals()`. Esta função é usada para gerar resíduos simulados a partir do modelo ajustado. Isso é feito para criar uma distribuição de referência que é usada para diagnosticar o modelo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DHARMa)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: pacote 'DHARMa' foi compilado no R versão 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThis is DHARMa 0.4.6. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nO gráfico da esquerda, *QQ Plot Residuals*, tem por objetivo verificar a normalidade dos resíduos. Este gráfico compara os quantis dos resíduos observados com os quantis de uma distribuição normal teórica. Os pontos no gráfico representam os resíduos simulados, e a linha diagonal representa a distribuição normal teórica. Na imagem, os pontos estão próximos da linha diagonal, indicando que os resíduos são aproximadamente normais.\n\nEsta mesma função realiza o teste de Kolmogorov-Smirnov (KS), este teste é usado para testar a hipótese de que os resíduos seguem uma distribuição normal. Um p-valor de 0.380 indica que não rejeitamos a hipótese nula de normalidade, sugerindo que os resíduos são normalmente distribuídos.\n\nJá o gráfico da direita, um *Boxplot de Resíduos vs. Valores Ajustados*, tem por objetico verificar a homocedasticidade (igualdade das variâncias) dos resíduos. Este boxplot mostra a distribuição dos resíduos simulados para diferentes valores preditos pelo modelo (valores ajustados). Neste gráfico as caixas parecem ter tamanhos muito diferentes, indicando possível heterocedasticidade.\n\nO teste de Levene, que é usado para testar a hipótese de homogeneidade das variâncias, também é aplicado ao se utilizar a função`simulateResiduals()` e significância do teste de Levene sugere que há heterocedasticidade, ou seja, a variância dos resíduos não é constante ao longo dos valores ajustados.\n\n## Transformação dos Dados\n\nQuando os dados não atendem aos pressupostos de normalidade e homocedasticidade, podemos aplicar uma transformação, como a raiz quadrada, Arco Seno, Logarítmica, Box Cox ou outros, para tentar normalizar os dados e estabilizar a variância.\n\n### Transformação - Raiz quadrada\n\nQuando temos dado de contagem geralmente se utiliza a raiz quadrada. Para isso transformamos a variável de contagem aplicando a raiz quadrada e visualizamos novamente os dados. Como no exempo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninseticida <- inseticida |>\n  mutate(count2 = sqrt(count))\ninseticida |>\n  ggplot(aes(x = spray, y = count2))+\n  geom_boxplot()+\n  geom_jitter()+\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 <- lm(count2 ~ spray,\n         data = inseticida)\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = count2 ~ spray, data = inseticida)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.24486 -0.39970 -0.01902  0.42661  1.40089 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   3.7607     0.1814  20.733  < 2e-16 ***\nsprayB        0.1160     0.2565   0.452    0.653    \nsprayC       -2.5158     0.2565  -9.807 1.64e-14 ***\nsprayD       -1.5963     0.2565  -6.223 3.80e-08 ***\nsprayE       -1.9512     0.2565  -7.606 1.34e-10 ***\nsprayF        0.2579     0.2565   1.006    0.318    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.6283 on 66 degrees of freedom\nMultiple R-squared:  0.7724,\tAdjusted R-squared:  0.7552 \nF-statistic:  44.8 on 5 and 66 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: count2\n          Df Sum Sq Mean Sq F value    Pr(>F)    \nspray      5 88.438 17.6876  44.799 < 2.2e-16 ***\nResiduals 66 26.058  0.3948                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nm2$residuals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          1           2           3           4           5           6 \n-0.59840073 -1.11492708  0.71145756 -0.01902101 -0.01902101 -0.29657678 \n          7           8           9          10          11          12 \n-0.59840073  1.03515313  0.36242723  0.71145756 -0.01902101 -0.15512712 \n         13          14          15          16          17          18 \n-0.56000661  0.24647423  0.70594430 -0.56000661  0.12336860 -0.13497401 \n         19          20          21          22          23          24 \n 0.24647423  0.24647423  0.48226755  0.70594430 -1.23088009 -0.27108012 \n         25          26          27          28          29          30 \n-1.24485667 -0.24485667  1.40089464  0.16935689  0.48719414 -0.24485667 \n         31          32          33          34          35          36 \n 0.16935689 -0.24485667  0.48719414 -1.24485667 -0.24485667  0.75514333 \n         37          38          39          40          41          42 \n-0.43230306  0.07171411  1.29974775  0.28513587 -0.16435387 -0.43230306 \n         43          44          45          46          47          48 \n 0.07171411  0.07171411  0.07171411  0.07171411 -0.75014031 -0.16435387 \n         49          50          51          52          53          54 \n-0.07741021  0.42660696 -0.07741021  0.42660696 -0.07741021  0.64002872 \n         55          56          57          58          59          60 \n-0.80946102 -0.80946102 -0.07741021 -0.39524746  0.64002872  0.19053898 \n         61          62          63          64          65          66 \n-0.70199237 -1.01861716 -0.14563382  0.67179860 -0.14563382 -0.01861716 \n         67          68          69          70          71          72 \n-0.41306589 -0.85633950  1.08040235  1.08040235  0.88036232 -0.41306589 \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(m2$residuals)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(m2$residuals)\nqqline(m2$residuals)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshapiro.test(m2$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  m2$residuals\nW = 0.98721, p-value = 0.6814\n```\n\n\n:::\n\n```{.r .cell-code}\nbartlett.test(count2 ~ spray,\n              data = inseticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBartlett test of homogeneity of variances\n\ndata:  count2 by spray\nBartlett's K-squared = 3.7525, df = 5, p-value = 0.5856\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(m2))\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.681).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.854).\n```\n\n\n:::\n:::\n\n\nAgora os dados atendem a normalidade e homocedasticidade.\n\nemmeans mostra o intervalo de confiança\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: pacote 'emmeans' foi compilado no R versão 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n```\n\n\n:::\n\n```{.r .cell-code}\nm1_medias <- emmeans(m1, ~ spray)\nplot(m1_medias)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(multcomp)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: mvtnorm\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: survival\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: pacote 'survival' foi compilado no R versão 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: TH.data\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: MASS\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: pacote 'MASS' foi compilado no R versão 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAnexando pacote: 'MASS'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nO seguinte objeto é mascarado por 'package:dplyr':\n\n    select\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAnexando pacote: 'TH.data'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nO seguinte objeto é mascarado por 'package:MASS':\n\n    geyser\n```\n\n\n:::\n\n```{.r .cell-code}\ncld(m1_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean   SE df lower.CL upper.CL .group\n C       2.08 1.13 66   -0.177     4.34  1    \n E       3.50 1.13 66    1.240     5.76  1    \n D       4.92 1.13 66    2.656     7.18  1    \n A      14.50 1.13 66   12.240    16.76   2   \n B      15.33 1.13 66   13.073    17.59   2   \n F      16.67 1.13 66   14.406    18.93   2   \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\nm2_medias <- emmeans(m2, ~ spray)\nplot(m2_medias)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(multcomp)\ncld(m2_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray emmean    SE df lower.CL upper.CL .group\n C       1.24 0.181 66    0.883     1.61  1    \n E       1.81 0.181 66    1.447     2.17  12   \n D       2.16 0.181 66    1.802     2.53   2   \n A       3.76 0.181 66    3.399     4.12    3  \n B       3.88 0.181 66    3.514     4.24    3  \n F       4.02 0.181 66    3.656     4.38    3  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 6 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npwpm(m2_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       A      B      C      D      E      F\nA [3.76] 0.9975 <.0001 <.0001 <.0001 0.9145\nB -0.116 [3.88] <.0001 <.0001 <.0001 0.9936\nC  2.516  2.632 [1.24] 0.0081 0.2513 <.0001\nD  1.596  1.712 -0.919 [2.16] 0.7366 <.0001\nE  1.951  2.067 -0.565  0.355 [1.81] <.0001\nF -0.258 -0.142 -2.774 -1.854 -2.209 [4.02]\n\nRow and column labels: spray\nUpper triangle: P values   adjust = \"tukey\"\nDiagonal: [Estimates] (emmean) \nLower triangle: Comparisons (estimate)   earlier vs. later\n```\n\n\n:::\n\n```{.r .cell-code}\npwpp(m2_medias)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(m2_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast estimate    SE df t.ratio p.value\n A - B      -0.116 0.257 66  -0.452  0.9975\n A - C       2.516 0.257 66   9.807  <.0001\n A - D       1.596 0.257 66   6.223  <.0001\n A - E       1.951 0.257 66   7.606  <.0001\n A - F      -0.258 0.257 66  -1.006  0.9145\n B - C       2.632 0.257 66  10.259  <.0001\n B - D       1.712 0.257 66   6.675  <.0001\n B - E       2.067 0.257 66   8.058  <.0001\n B - F      -0.142 0.257 66  -0.554  0.9936\n C - D      -0.919 0.257 66  -3.584  0.0081\n C - E      -0.565 0.257 66  -2.201  0.2513\n C - F      -2.774 0.257 66 -10.813  <.0001\n D - E       0.355 0.257 66   1.383  0.7366\n D - F      -1.854 0.257 66  -7.229  <.0001\n E - F      -2.209 0.257 66  -8.612  <.0001\n\nP value adjustment: tukey method for comparing a family of 6 estimates \n```\n\n\n:::\n:::\n\n\npodemos aplicar de Box-Cox\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nb <- boxcox(lm(inseticida$count + 0.1 ~ 1))\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlambda <- b$x[which.max(b$y)]\nlambda\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4242424\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninseticida$count3 <- (inseticida$count^lambda-1)/lambda\ninseticida$count3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  3.903635  3.024469  6.043993  4.864268  4.864268  4.407118  3.903635\n [8]  6.557185  5.484274  6.043993  4.864268  4.640760  4.161975  5.484274\n[15]  6.219699  4.161975  5.285168  4.864268  5.484274  5.484274  5.863153\n[22]  6.219699  3.024469  4.640760 -2.357143  0.000000  3.024469  0.805831\n[29]  1.399509  0.000000  0.805831  0.000000  1.399509 -2.357143  0.000000\n[36]  1.887150  1.399509  2.308577  4.407118  2.683787  1.887150  1.399509\n[43]  2.308577  2.308577  2.308577  2.308577  0.805831  1.887150  1.399509\n[50]  2.308577  1.399509  2.308577  1.399509  2.683787  0.000000  0.000000\n[57]  1.399509  0.805831  2.683787  1.887150  4.161975  3.629951  5.078760\n[64]  6.390651  5.078760  5.285168  4.640760  3.903635  7.033117  7.033117\n[71]  6.719601  4.640760\n```\n\n\n:::\n:::\n\n\nSe lambda for igual a 0.5 é igual a raiz quadrada\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm5 <- lm(count3 ~ spray,\n         data = inseticida)\nlibrary(DHARMa)\nplot(simulateResiduals(m5))\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: residuals appear as normally distributed (p = 0.772).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_heteroscedasticity(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOK: Error variance appears to be homoscedastic (p = 0.246).\n```\n\n\n:::\n:::\n\n\nAlternativa, usando testes não paramétricos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(agricolae)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: pacote 'agricolae' foi compilado no R versão 4.4.1\n```\n\n\n:::\n\n```{.r .cell-code}\nprint('-=-=-=-=-=-=- DO PRÓPRIO R -=-=-=-=-=-=-')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"-=-=-=-=-=-=- DO PRÓPRIO R -=-=-=-=-=-=-\"\n```\n\n\n:::\n\n```{.r .cell-code}\nkruskal.test(count ~ spray,\n             data = inseticida)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  count by spray\nKruskal-Wallis chi-squared = 54.691, df = 5, p-value = 1.511e-10\n```\n\n\n:::\n\n```{.r .cell-code}\nprint('-=-=-=-=-=-=- DO PACOTE AGRICOLAE -=-=-=-=-=-=-')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"-=-=-=-=-=-=- DO PACOTE AGRICOLAE -=-=-=-=-=-=-\"\n```\n\n\n:::\n\n```{.r .cell-code}\nm3 <- kruskal(inseticida$count,\n        inseticida$spray,\n        group = TRUE)\nm3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$statistics\n     Chisq Df      p.chisq  t.value      MSD\n  54.69134  5 1.510845e-10 1.996564 8.462804\n\n$parameters\n            test p.ajusted           name.t ntr alpha\n  Kruskal-Wallis      none inseticida$spray   6  0.05\n\n$means\n  inseticida.count     rank      std  r Min Max   Q25  Q50   Q75\nA        14.500000 52.16667 4.719399 12   7  23 11.50 14.0 17.75\nB        15.333333 54.83333 4.271115 12   7  21 12.50 16.5 17.50\nC         2.083333 11.45833 1.975225 12   0   7  1.00  1.5  3.00\nD         4.916667 25.58333 2.503028 12   2  12  3.75  5.0  5.00\nE         3.500000 19.33333 1.732051 12   1   6  2.75  3.0  5.00\nF        16.666667 55.62500 6.213378 12   9  26 12.50 15.0 22.50\n\n$comparison\nNULL\n\n$groups\n  inseticida$count groups\nF         55.62500      a\nB         54.83333      a\nA         52.16667      a\nD         25.58333      b\nE         19.33333     bc\nC         11.45833      c\n\nattr(,\"class\")\n[1] \"group\"\n```\n\n\n:::\n:::\n\n\ngeneralizado é mais bonito, mais moderno, mais aceito.\n\nAlternativa usando GLMs\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm4 <- glm(count ~spray,\n          family = gaussian,\n          data = inseticida)\nsummary(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = count ~ spray, family = gaussian, data = inseticida)\n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  14.5000     1.1322  12.807  < 2e-16 ***\nsprayB        0.8333     1.6011   0.520    0.604    \nsprayC      -12.4167     1.6011  -7.755 7.27e-11 ***\nsprayD       -9.5833     1.6011  -5.985 9.82e-08 ***\nsprayE      -11.0000     1.6011  -6.870 2.75e-09 ***\nsprayF        2.1667     1.6011   1.353    0.181    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 15.38131)\n\n    Null deviance: 3684.0  on 71  degrees of freedom\nResidual deviance: 1015.2  on 66  degrees of freedom\nAIC: 408.85\n\nNumber of Fisher Scoring iterations: 2\n```\n\n\n:::\n\n```{.r .cell-code}\nanova(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table\n\nModel: gaussian, link: identity\n\nResponse: count\n\nTerms added sequentially (first to last)\n\n      Df Deviance Resid. Df Resid. Dev      F    Pr(>F)    \nNULL                     71     3684.0                     \nspray  5   2668.8        66     1015.2 34.702 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: carData\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAnexando pacote: 'car'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nO seguinte objeto é mascarado por 'package:dplyr':\n\n    recode\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nO seguinte objeto é mascarado por 'package:purrr':\n\n    some\n```\n\n\n:::\n\n```{.r .cell-code}\nAnova(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: count\n      LR Chisq Df Pr(>Chisq)    \nspray   173.51  5  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nTem que olhar a familia da distribuição olhando os pressupostos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DHARMa)\nm5 <- glm(count ~spray,\n          family = poisson,\n          data = inseticida)\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = count ~ spray, family = poisson, data = inseticida)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  2.67415    0.07581  35.274  < 2e-16 ***\nsprayB       0.05588    0.10574   0.528    0.597    \nsprayC      -1.94018    0.21389  -9.071  < 2e-16 ***\nsprayD      -1.08152    0.15065  -7.179 7.03e-13 ***\nsprayE      -1.42139    0.17192  -8.268  < 2e-16 ***\nsprayF       0.13926    0.10367   1.343    0.179    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 409.041  on 71  degrees of freedom\nResidual deviance:  98.329  on 66  degrees of freedom\nAIC: 376.59\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n\n```{.r .cell-code}\nAnova(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: count\n      LR Chisq Df Pr(>Chisq)    \nspray   310.71  5  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(simulateResiduals(m5))\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nm5_medias <- emmeans(m5, ~ spray,\n                     type = 'response')\nlibrary(multcomp)\nlibrary(multcompView)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: pacote 'multcompView' foi compilado no R versão 4.4.1\n```\n\n\n:::\n\n```{.r .cell-code}\ncld(m5_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n spray  rate    SE  df asymp.LCL asymp.UCL .group\n C      2.08 0.417 Inf      1.41      3.08  1    \n E      3.50 0.540 Inf      2.59      4.74  12   \n D      4.92 0.640 Inf      3.81      6.35   2   \n A     14.50 1.099 Inf     12.50     16.82    3  \n B     15.33 1.130 Inf     13.27     17.72    3  \n F     16.67 1.179 Inf     14.51     19.14    3  \n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nP value adjustment: tukey method for comparing a family of 6 estimates \nTests are performed on the log scale \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\nOutro conjunto de dados two-way anova - ANOVA fatorial\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nli <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672\")\n\nhead(li)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 8\n  treat         dose   rep  n_sp dis_sp n_seeds inf_seeds severity\n  <chr>        <dbl> <dbl> <dbl>  <dbl>   <dbl>     <dbl>    <dbl>\n1 Ionic liquid   0.5     1   103     13      25        10   0.126 \n2 Ionic liquid   0.5     2   125     31      25        12   0.248 \n3 Ionic liquid   0.5     3   210     80      25        12   0.381 \n4 Ionic liquid   0.5     4    97     28      25        10   0.289 \n5 Ionic liquid   0.5     5   180     75      25        11   0.417 \n6 Ionic liquid   2       2   116      9      25         6   0.0776\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nli |>\n  ggplot(aes(factor(dose),severity, color = factor(dose)))+\n  geom_jitter(width = 0.1)+\n  facet_wrap(~treat)+\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nli |>\n  ggplot(aes(treat ,severity, color = factor(dose)))+\n  geom_jitter(width = 0.1)\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\nModelo fatoral - Para DIC\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmf <- lm(severity ~ treat*factor(dose),\n         data = li)\nmf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = severity ~ treat * factor(dose), data = li)\n\nCoefficients:\n                    (Intercept)                treatTebuconazole  \n                         0.2921                          -0.2711  \n                  factor(dose)2  treatTebuconazole:factor(dose)2  \n                        -0.2420                           0.2412  \n```\n\n\n:::\n\n```{.r .cell-code}\nanova(mf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: severity\n                   Df   Sum Sq  Mean Sq F value    Pr(>F)    \ntreat               1 0.113232 0.113232  30.358 4.754e-05 ***\nfactor(dose)        1 0.073683 0.073683  19.755 0.0004077 ***\ntreat:factor(dose)  1 0.072739 0.072739  19.502 0.0004326 ***\nResiduals          16 0.059678 0.003730                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DHARMa)\nplot(simulateResiduals(mf))\n```\n\n::: {.cell-output-display}\n![](aula_07_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(performance)\ncheck_normality(mf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Non-normality of residuals detected (p = 0.011).\n```\n\n\n:::\n\n```{.r .cell-code}\ncheck_homogeneity(mf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nWarning: Variances differ between groups (Bartlett Test, p = 0.001).\n```\n\n\n:::\n:::\n\n\nO cld, do pacote multcomp, coloca as letras.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmf_medias <- emmeans(mf, ~ treat | dose)\nmf_medias\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ndose = 0.5:\n treat        emmean     SE df lower.CL upper.CL\n Ionic liquid 0.2921 0.0273 16  0.23420   0.3500\n Tebuconazole 0.0210 0.0273 16 -0.03690   0.0789\n\ndose = 2.0:\n treat        emmean     SE df lower.CL upper.CL\n Ionic liquid 0.0501 0.0273 16 -0.00781   0.1080\n Tebuconazole 0.0202 0.0273 16 -0.03768   0.0781\n\nConfidence level used: 0.95 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(multcomp)\nmf_medias <- emmeans(mf, ~ dose | treat)\ncld(mf_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat = Ionic liquid:\n dose emmean     SE df lower.CL upper.CL .group\n  2.0 0.0501 0.0273 16 -0.00781   0.1080  1    \n  0.5 0.2921 0.0273 16  0.23420   0.3500   2   \n\ntreat = Tebuconazole:\n dose emmean     SE df lower.CL upper.CL .group\n  2.0 0.0202 0.0273 16 -0.03768   0.0781  1    \n  0.5 0.0210 0.0273 16 -0.03690   0.0789  1    \n\nConfidence level used: 0.95 \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n",
    "supporting": [
      "aula_07_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}